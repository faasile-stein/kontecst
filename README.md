# Kontecst

> Platform for versioned, queryable context for AI agents—served via API or managed vector stores.

## What is Kontecst?

Kontecst lets developers and teams curate structured `.md` files, version them, and serve them to LLM agents as raw Markdown, via an API, or through fully managed vector stores backed by Postgres/pgvector.

### Key Features

- **Kontecst Packages** → Collections of `.md` files with metadata and versioning
- **Versioning** → Immutable snapshots on publish with semver
- **Kontecst Editor** → Guided, AI-assisted Markdown editor
- **Feeds** → Public or private distribution channels for knowledge
- **Multiple Serving Modes**:
  - Raw `.md` files
  - REST/GraphQL API
  - PostgreSQL vector store (shared or dedicated)
- **Embeddings Pipeline** → Automatic chunking, embedding, and indexing
- **Enterprise Features** → SSO, audit logs, dedicated databases, data residency

## Quick Start

### Prerequisites

- Node.js 18+
- pnpm 8+
- Docker & Docker Compose
- Supabase account

### Installation

**Option 1: Automated Setup (Recommended)**

```bash
# Clone the repository
git clone https://github.com/your-org/kontecst.git
cd kontecst

# Run automated setup
pnpm setup

# Configure .env files with:
# - Supabase URL and keys (from your Supabase project)
# - OpenAI API key (for embeddings and semantic search)
# - Encryption key (generated by setup script)

# Start all services
pnpm dev:start
```

**Option 2: Manual Setup**

```bash
# Clone the repository
git clone https://github.com/your-org/kontecst.git
cd kontecst

# Install dependencies
pnpm install

# Copy environment variables
cp .env.example .env
cp apps/web/.env.example apps/web/.env
cp apps/proxy/.env.example apps/proxy/.env

# Generate encryption key
openssl rand -hex 32

# Configure .env files with credentials
# ...

# Start Docker services
pnpm docker:up

# Start development servers
pnpm dev
```

This will start:
- Next.js web app on `http://localhost:3000`
- File proxy service on `http://localhost:3001`
- PostgreSQL with pgvector on `localhost:5432`

**Development Commands:**

```bash
pnpm dev:start    # Start all services (automated)
pnpm dev:stop     # Stop all services
pnpm dev:status   # Check service status
pnpm docker:logs  # View Docker logs
```

### Project Structure

```
kontecst/
├── apps/
│   ├── web/              # Next.js web application
│   └── proxy/            # File proxy service (Fastify)
├── packages/
│   ├── database/         # Supabase migrations and schema
│   └── shared/           # Shared types and utilities
├── scripts/              # Development and setup scripts
├── docker/               # Docker configurations
└── docker-compose.yml    # Local development environment
```

## Troubleshooting

### Next.js Script Loading Errors

If you see browser errors like `Loading failed for the <script> with source "/_next/static/chunks/fallback/..."`:

1. **The dev server is not running or build artifacts are missing.**

   **Solution:**
   ```bash
   # Stop any running servers
   pnpm dev:stop

   # Clean and reinstall dependencies
   rm -rf node_modules .pnpm-store
   pnpm install --ignore-scripts

   # Start the dev server
   cd apps/web
   pnpm dev
   ```

2. **If the install fails with Supabase postinstall errors**, use `--ignore-scripts`:
   ```bash
   pnpm install --ignore-scripts
   ```

3. **The .next build directory should be automatically created** when the dev server starts. If issues persist:
   ```bash
   cd apps/web
   rm -rf .next
   pnpm dev
   ```

### Environment Variable Issues

If you see errors like `SUPABASE_URL environment variable is required` or `Your project's URL and Key are required`:

1. **Run the setup script if you haven't already:**
   ```bash
   pnpm setup
   ```

2. **Verify .env files exist:**
   ```bash
   ls -la .env apps/web/.env apps/proxy/.env
   ```

3. **Configure Supabase credentials in ALL required locations:**

   **Root `.env`:**
   ```env
   SUPABASE_URL=https://your-project.supabase.co
   SUPABASE_ANON_KEY=your-anon-key
   SUPABASE_SERVICE_KEY=your-service-role-key
   ```

   **`apps/web/.env`:**
   ```env
   NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
   NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
   ```

   **`apps/proxy/.env`:**
   ```env
   SUPABASE_URL=https://your-project.supabase.co
   SUPABASE_SERVICE_KEY=your-service-role-key
   ```

4. **Get your Supabase credentials:**
   - Go to https://app.supabase.com/project/_/settings/api
   - Copy the Project URL as `SUPABASE_URL`
   - Copy the `anon` `public` key as `SUPABASE_ANON_KEY` or `NEXT_PUBLIC_SUPABASE_ANON_KEY`
   - Copy the `service_role` `secret` key as `SUPABASE_SERVICE_KEY`

5. **Restart the development servers:**
   ```bash
   pnpm dev:stop
   pnpm dev:start
   ```

## Documentation

- [Architecture Overview](./docs/ARCHITECTURE.md)
- [Development Guide](./docs/DEVELOPMENT.md)
- [Development Scripts](./scripts/README.md) - Setup and development automation
- [Deployment Guide](./docs/DEPLOYMENT.md)
- [API Documentation](./docs/API.md)

## Use Cases

### For AI Builders
Provide accurate, controlled context to your AI agents with version control and access management.

### For Enterprises
Private, secure, versioned knowledge base for internal AI agents with audit logging and compliance features.

### For Open Source Creators
Publish public "context packages" that users can subscribe to and query.

## Tech Stack

- **Frontend**: Next.js 14 (TypeScript, React, Tailwind CSS)
- **Backend**: Fastify (TypeScript, Node.js)
- **Database**: Supabase (PostgreSQL + pgvector)
- **Deployment**: Vercel (frontend), Docker containers (proxy + dedicated DBs)
- **Auth**: Supabase Auth
- **Payments**: Stripe

## Roadmap

### Phase 1 - MVP ✅
- [x] Monorepo setup
- [x] Database schema
- [x] File proxy with encryption
- [x] Package creation & versioning
- [x] File upload system
- [x] Vector search (semantic + keyword)
- [x] API endpoints
- [x] Authentication (email + OAuth)
- [x] Dashboard UI
- [x] Embeddings generation

### Phase 2 - Team & Growth ✅
- [x] Rich Markdown editor with live preview
- [x] Diff viewer for version comparison
- [x] Public marketplace for package discovery
- [x] Usage analytics dashboard
- [x] Reviews/approvals workflow
- [x] GitHub sync integration

### Phase 3 - Enterprise ✅
- [x] Team management with role-based permissions
- [x] Organization invitations with tokens
- [x] Dedicated PostgreSQL instances
- [x] Multi-region support (6 regions)
- [x] Region selection for data residency
- [x] Comprehensive audit logging
- [x] Admin dashboard for enterprise features
- [x] Advanced semantic search filters
- [x] SSO/SAML integration (SAML 2.0, OIDC, OAuth 2.0)

## Contributing

We welcome contributions! Please see [CONTRIBUTING.md](./CONTRIBUTING.md) for details.

## License

MIT License - see [LICENSE](./LICENSE) for details.

## Support

- Documentation: [docs/](./docs/)
- Issues: [GitHub Issues](https://github.com/your-org/kontecst/issues)
- Discussions: [GitHub Discussions](https://github.com/your-org/kontecst/discussions)